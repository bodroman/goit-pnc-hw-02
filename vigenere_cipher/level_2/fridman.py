# Визначаємо довжину ключа методом Фрідмана

import re
from collections import Counter

def calculate_ic(text):
    n = len(text)
    frequency = Counter(text)
    ic = sum(f * (f - 1) for f in frequency.values()) / (n * (n - 1))
    return ic

def friedman_test(ciphertext, max_key_length=20):
    ciphertext = re.sub(r'[^A-Z]', '', ciphertext.upper())  # Залишаємо лише букви
    possible_key_lengths = {}

    for key_length in range(1, max_key_length + 1):
        groups = ['' for _ in range(key_length)]
        
        # Розбиваємо текст на групи
        for i, char in enumerate(ciphertext):
            groups[i % key_length] += char
        
        # Обчислюємо середній IC для груп
        ic_values = [calculate_ic(group) for group in groups]
        avg_ic = sum(ic_values) / key_length
        possible_key_lengths[key_length] = avg_ic

    return possible_key_lengths

# Зашифрований текст
ciphertext = '''VYC PKHOJT XZ RJV AGXOZFR DM ZGRSIBTAC TWPLIJ. RD KSBVAA HPV RLS VCTTEPS RJV YGMWYK IH HPV'J YXF.
HNV CGPRKT GH AS CYO RHL VIYCLZGKE XURQ RLDMVKI MPULGI MG T BKN MPACTZYA AWY ZMEYCUJGDG CL SEPBRKWSA MVOEGH.
AFG YGVASYK, AH AFG CMLXGZ, WOGT MH TPXMWIZSB PQ C DMSX CL RUIVZKFEGTDNP.
TWVQG NFD YWTU UVSW OVYCBBMJ IC ICCLRXYIR KHXUEU RPT VCXIUEA UKKFDNH HVICN AJRPBBBM.
KHXZ GU R DPNZZ. KHDZC YYM UBBJ SEPBRKWSA FSGEICNQ KE ZTTIZZFJS RJZLVL OXV TWL AWCRXOOZVD.
UVP VYCHX HNVRT PQ JFNT. MVKP AGL RJV CAXQZ KO LOMO SCPNHOWUA AFKEEH FSGE OCSW DVYJMM.
ZYEGL GU EM HNQN KHXUE CJ Y BHFGC OG HL KDKDKOR SODR. ZQFIH TFK NEAS UTZRIXB, UI BPKJA NPXMHKE. TWHR KJ YAE.
HNV NXUCVVCCMV-IVNIBPA UGHEWQV OU YCCCGHF WY KHT YYIV MU VORZBPU QGVGCZ VOJ OLU DCTC XG O MCAHZ.
RJV LXGSZVECAF-EVLINFE UIHSGMV MU KCSRNIPAKJK XL HNV RPNC QW APEWHRN CVR UVCXGU NZS DDL HRAT BB G XLPZQ.
VYC BHFGC LXMC QW KPG TUIMH WYTK MU MVK JUQQCEK KPMHKI OU AFG RPIBGZ,
SUI AFG DMGTZOKY DM YTK ADGGOJTH PL VYC EXFLVCI BQG FD PG WSGEGMCEK KTWWAD.
ND HPVZQI WSYZRTZ RQ GPDOS GEYIOGPX. CKXB ZYICNQ VYYI TFK KRJL ACE ZT IFUMES.
UM CIRXLH NRS TAFKTYA LMSGAIOGGJ. YC XHNZCPS QADNPMVE ZN PU YTKGHM WY RN JUNCIBDGOHCE BHLPVPXLA UW SIFJG.
EM PKHOJT XZ CXVP BHFHZD. IOC CIRXLH IRN TENTVQH XJKIYIOGPX.
RWHIMYT PUB NRLVNOMV AGL RQ KFT TFZZSI PLUKPJFSTKS DM YP RPI.
OWIV ACK TKIRJX OXV TD AFG RPIBGZ DAILPKRJH YCX RN PYR.
HIMB MVK GOXUR QW TXXK UW FDYK, VYC IRDK FF PSJ VYC PKHY ZS IOC CIR DY HNV MJZGEZYC.
YFUD TWL NQZLI HT BZEL VD HVCABBM, KHT HAVFP'H VFGWT XZ RJV RNIS.
GCL PYR KJ YI HBIV SJYDCTC PGR YPMQVJ. VYMHX KNF GD ICPVYIA HNV SJYDCTC SH GU RT IOCKI NTKWR.
KHDZC YYM GXOJ KHT ZWOSMA WC YF AI AFGZP EXFOC.
II PQ VYC HISIKAIVP, CEB CHH RZFT, AFCK YGM FKRLAF KKIPDKG.
JZVTYQKKW DY CVZNXVL CSMJM O CFRZ VD CIR HACCJ TWHR VYC LHFQ ZS CLU, EFKEESD, MIIHJ.
YYCC VFOKIRZ BKJYVKSK KHT HPVZQI BG OE ARJMTU UXMV NZMHLJH.
NC RTB LFRVPTG R KPG TUI MPRGPX Y JLSLLL IOGPX YH ECTX AH OC FFCH GCZ RDBPPG ZR.
IAS UELN LVELQT YCX DAZPLI R SHXZKJS IOGPX GH MVGK OCL YFDGGXG OK ICACPJCAR.
ORC AGA GU HSXMS AJEALQU.'''

# Результати тесту
ic_results = friedman_test(ciphertext, max_key_length=20)

# Виведення IC для різних довжин ключів
for length, ic in ic_results.items():
    print(f"Довжина ключа: {length}, IC: {ic:.4f}")
